<%- include('partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-5">
    <h2 class="font-serif">Rooms Inventory</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#roomModal">+ Add Physical Room</button>
</div>

<div class="card border-0 shadow-sm overflow-hidden">
    <table class="table table-hover align-middle mb-0">
        <thead class="bg-dark text-white">
            <tr>
                <th class="ps-4">Room Number</th>
                <th>Type</th>
                <th>Status</th>
                <th>Visibility</th>
                <th class="text-end pe-4">Actions</th>
            </tr>
        </thead>
        <tbody>
            <% rooms.forEach(room => { %>
            <tr class="<%= room.is_active ? '' : 'bg-light opacity-75' %>">
                <td class="ps-4 fw-bold"><%= room.room_number %></td>
                <td class="small"><%= room.type_name %></td>
                <td>
                    <span class="badge <%= room.status === 'available' ? 'bg-success' : (room.status === 'occupied' ? 'bg-danger' : 'bg-warning text-dark') %> status-badge">
                        <%= room.status %>
                    </span>
                </td>
                <td>
                    <span class="badge <%= room.is_active ? 'bg-info' : 'bg-secondary' %> status-badge">
                        <%= room.is_active ? 'Live' : 'Hidden' %>
                    </span>
                </td>
                <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-dark" onclick="editRoom('<%= JSON.stringify(room) %>')">Modify</button>
                </td>
            </tr>
            <% }) %>
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="roomModal" tabindex="-1">
    <div class="modal-dialog">
        <form action="/rooms" method="POST" class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">Room Configuration</h5>
            </div>
            <div class="modal-body">
                <input type="hidden" name="id" id="room_id">
                <div class="mb-3">
                    <label class="form-label small fw-bold">ROOM NUMBER</label>
                    <input type="text" name="room_number" id="room_num" class="form-control" placeholder="e.g. 101" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ROOM TYPE</label>
                    <select name="room_type_id" id="room_type" class="form-select" required>
                        <% types.forEach(type => { %>
                            <option value="<%= type.id %>"><%= type.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CURRENT STATUS</label>
                    <select name="status" id="room_status" class="form-select">
                        <option value="available">Available</option>
                        <option value="occupied">Occupied</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" name="is_active" id="room_active" checked>
                    <label class="form-check-label small fw-bold">ACTIVE ON SYSTEM</label>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="submit" class="btn btn-primary w-100">COMMIT CHANGES</button>
            </div>
        </form>
    </div>
</div>

<script>
function editRoom(data) {
    const room = JSON.parse(data);
    document.getElementById('room_id').value = room.id;
    document.getElementById('room_num').value = room.room_number;
    document.getElementById('room_type').value = room.room_type_id;
    document.getElementById('room_status').value = room.status;
    document.getElementById('room_active').checked = room.is_active === 1;
    new bootstrap.Modal(document.getElementById('roomModal')).show();
}
</script>

<%- include('partials/footer') %>