<%- include('partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="font-serif mb-1">Point of Sale (POS)</h2>
        <p class="text-muted small mb-0">Charge culinary services directly to guest rooms</p>
    </div>
</div>

<% if (activeBookings.length === 0) { %>
    <div class="alert alert-info border-0 rounded-0 shadow-sm">
        <strong>Notice:</strong> There are no guests currently checked in. Charges can only be applied to active residents.
    </div>
<% } %>

<div class="row g-4">
    <!-- Menu Selection -->
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm p-4">
            <h6 class="text-uppercase small fw-bold text-muted mb-4" style="letter-spacing: 0.1em;">Digital Menu</h6>
            
            <div class="row g-3">
                <% ['food', 'deserts', 'wine'].forEach(cat => { %>
                    <div class="col-12 mt-4">
                        <h6 class="text-primary small fw-bold border-bottom pb-2"><%= cat.toUpperCase() %></h6>
                    </div>
                    <% menu.filter(m => m.category === cat).forEach(item => { %>
                        <div class="col-md-4">
                            <div class="p-3 border h-100 d-flex flex-column justify-content-between hover-shadow transition" style="cursor: pointer;" onclick="selectItem('<%= item.id %>', '<%= item.name %>', <%= item.price %>)">
                                <div>
                                    <div class="fw-bold small"><%= item.name %></div>
                                    <div class="text-muted" style="font-size: 0.7rem;"><%= item.description %></div>
                                </div>
                                <div class="mt-2 fw-bold text-success">$<%= item.price.toFixed(2) %></div>
                            </div>
                        </div>
                    <% }) %>
                <% }) %>
            </div>
        </div>
    </div>

    <!-- Charge Details -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm sticky-top" style="top: 2rem;">
            <div class="bg-dark text-white p-3">
                <h6 class="mb-0 small fw-bold text-uppercase" style="letter-spacing: 0.1em;">Service Charge</h6>
            </div>
            <form action="/pos/charge" method="POST" class="p-4">
                <input type="hidden" name="item_id" id="selected_item_id" required>
                
                <div class="mb-4">
                    <label class="form-label small fw-bold text-muted">SELECTED ITEM</label>
                    <div id="display_item" class="p-2 bg-light border text-muted small italic">Click an item from the menu</div>
                </div>

                <div class="mb-4">
                    <label class="form-label small fw-bold text-muted">SELECT ROOM / GUEST</label>
                    <select name="booking_id" class="form-select" required <%= activeBookings.length === 0 ? 'disabled' : '' %>>
                        <option value="">Choose resident...</option>
                        <% activeBookings.forEach(b => { %>
                            <option value="<%= b.id %>">Room <%= b.room_number %> - <%= b.guest_name %></option>
                        <% }) %>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="form-label small fw-bold text-muted">QUANTITY</label>
                    <input type="number" name="quantity" class="form-control" value="1" min="1" max="20">
                </div>

                <div class="pt-3 border-top mt-4">
                    <div class="d-flex justify-content-between mb-3">
                        <span class="text-muted">Subtotal</span>
                        <span class="fw-bold" id="display_price">$0.00</span>
                    </div>
                    <button type="submit" class="btn btn-dark w-100 py-2 rounded-0" id="chargeBtn" disabled>CHARGE TO ROOM</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .hover-shadow:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-color: #18181b !important; }
    .transition { transition: all 0.2s ease-in-out; }
</style>

<script>
function selectItem(id, name, price) {
    document.getElementById('selected_item_id').value = id;
    document.getElementById('display_item').textContent = name;
    document.getElementById('display_item').classList.remove('italic', 'text-muted');
    document.getElementById('display_item').classList.add('fw-bold');
    document.getElementById('display_price').textContent = '$' + price.toFixed(2);
    document.getElementById('chargeBtn').disabled = false;
}
</script>

<%- include('partials/footer') %>
