<%- include('partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="font-serif mb-1">Housekeeping & Maintenance</h2>
        <p class="text-muted small mb-0">Room readiness and facility management</p>
    </div>
</div>

<!-- Status Overview -->
<div class="row g-4 mb-5">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm p-4 h-100 bg-danger text-white">
            <span class="small opacity-75 text-uppercase fw-bold" style="letter-spacing: 0.1em;">Dirty Rooms</span>
            <h2 class="mb-0 mt-1"><%= stats.dirty %></h2>
            <small class="opacity-50">Immediate attention required</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm p-4 h-100 bg-warning">
            <span class="small text-muted text-uppercase fw-bold" style="letter-spacing: 0.1em;">Maintenance</span>
            <h2 class="mb-0 mt-1"><%= stats.maintenance %></h2>
            <small class="text-muted">Out of service</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm p-4 h-100 bg-success text-white">
            <span class="small opacity-75 text-uppercase fw-bold" style="letter-spacing: 0.1em;">Ready to Sell</span>
            <h2 class="mb-0 mt-1"><%= stats.available %></h2>
            <small class="opacity-50">Available for check-in</small>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm overflow-hidden">
    <table class="table table-hover align-middle mb-0">
        <thead class="bg-dark text-white text-[10px] uppercase tracking-widest">
            <tr>
                <th class="ps-4 py-3">Room</th>
                <th class="py-3">Type</th>
                <th class="py-3">Status</th>
                <th class="py-3">Last Updated</th>
                <th class="py-3 text-end pe-4">Actions</th>
            </tr>
        </thead>
        <tbody>
            <% rooms.forEach(room => { %>
            <tr>
                <td class="ps-4 fw-bold">Room <%= room.room_number %></td>
                <td class="small text-muted"><%= room.type_name %></td>
                <td>
                    <span class="badge status-badge <%= room.status === 'dirty' ? 'bg-danger' : (room.status === 'maintenance' ? 'bg-warning text-dark' : 'bg-success') %>">
                        <%= room.status.toUpperCase() %>
                    </span>
                </td>
                <td class="small text-muted">
                    <%= new Date(room.updated_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
                </td>
                <td class="text-end pe-4">
                    <div class="d-flex gap-2 justify-content-end">
                        <% if (room.status === 'dirty') { %>
                            <form action="/housekeeping/<%= room.id %>/clean" method="POST">
                                <button class="btn btn-sm btn-dark px-3">Mark Clean</button>
                            </form>
                        <% } %>
                        
                        <form action="/housekeeping/<%= room.id %>/maintenance" method="POST">
                            <button class="btn btn-sm btn-outline-dark">
                                <%= room.status === 'maintenance' ? 'End Maintenance' : 'Start Maintenance' %>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            <% }) %>
            <% if (rooms.length === 0) { %>
                <tr><td colspan="5" class="text-center py-5 text-muted small">No rooms currently in cleaning or maintenance queue</td></tr>
            <% } %>
        </tbody>
    </table>
</div>

<%- include('partials/footer') %>
